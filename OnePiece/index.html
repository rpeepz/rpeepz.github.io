<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One Piece Card War v1.3</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">
    
    <!-- PeerJS for WebRTC P2P connections -->
    <script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <!-- Theme Toggle -->
    <div id="theme-toggle" class="theme-toggle">
        <span class="theme-toggle-icon" id="theme-icon">üåô</span>
        <span id="theme-text">Dark</span>
    </div>

    <!-- Battle Music Audio -->
    <audio id="battle-music" loop>
        <source src="https://quicksounds.com/uploads/tracks/143341674_950320944_1102458802.mp3" type="audio/mpeg">
    </audio>

    <!-- Team Battle Music Audio -->
    <audio id="team-battle-music" loop>
        <source src="https://us-tuna-sounds-files.voicemod.net/86e570ed-a8db-490d-abde-cdf5a3ad9a40-1664011058207.mp3" type="audio/mpeg">
    </audio>

    <!-- Music Control Widget -->
    <div id="music-control" class="music-control">
        <button id="music-control-close" class="music-control-close">√ó</button>
        <!-- <h4>üéµ Battle Music</h4> -->
        <div class="volume-controls">
            <button id="volume-full" class="volume-btn active">üîä</button>
            <button id="volume-half" class="volume-btn">üîà</button>
            <button id="volume-mute" class="volume-btn">üîá</button>
        </div>
    </div>

    <!-- Login/Profile Screen -->
    <div id="login-screen" class="screen active">
        <div class="container">
            <h1>‚öîÔ∏è One Piece Card War ‚öîÔ∏è</h1>
            <div class="login-options">
                <button id="guest-btn" class="btn btn-primary">Play as Guest</button>
                <button id="claim-profile-btn" class="btn btn-secondary">Claim Profile</button>
                <button id="login-btn" class="btn btn-secondary">Login to Profile</button>
            </div>
            <div id="profile-form" class="hidden">
                <input type="text" id="username-input" placeholder="Enter username" maxlength="20">
                <input type="password" id="password-input" placeholder="Enter password (optional for guest)">
                <button id="submit-profile-btn" class="btn btn-primary">Submit</button>
                <button id="cancel-btn" class="btn btn-secondary">Cancel</button>
            </div>
            <a href="https://square.link/u/T6XoDQMr" target="_blank" class="support-link">
                <button class="btn btn-support">‚òï Buy Me a Coffee</button>
            </a>
        </div>
    </div>

    <!-- Lobby Screen -->
    <div id="lobby-screen" class="screen">
        <div class="container">
            <div class="header">
                <h2>Welcome, <span id="player-name" class="my-username"></span>!
                    <a href="#" id="claim-profile-link" class="claim-profile-link hidden">Claim Profile</a>
                </h2>
                <div style="display: flex; gap: 10px;">
                    <button id="clear-data-btn" class="btn btn-small btn-danger">Clear Data</button>
                    <button id="logout-btn" class="btn btn-small">Logout</button>
                </div>
            </div>
            
            <div class="stats">
                <p>Wins: <span id="wins">0</span> | Losses: <span id="losses">0</span> | Cards Collected: <span id="cards-collected">0</span></p>
            </div>

            <div class="lobby-actions">
                <!-- Bot Mode Section (NEW) -->
                <div class="section">
                    <h3>ü§ñ Play vs Bot (Offline)</h3>
                    <button id="play-bot-btn" class="btn btn-primary">Play vs Bot</button>
                    <div id="difficulty-selector" class="hidden">
                        <h4>Select Difficulty:</h4>
                        <div class="difficulty-buttons">
                            <button class="btn btn-difficulty" data-difficulty="EASY">
                                <span class="difficulty-icon">üòä</span>
                                <span class="difficulty-name">Easy</span>
                                <span class="difficulty-desc">F, D, C cards</span>
                            </button>
                            <button class="btn btn-difficulty" data-difficulty="NORMAL">
                                <span class="difficulty-icon">üôÇ</span>
                                <span class="difficulty-name">Normal</span>
                                <span class="difficulty-desc">D, C, B cards</span>
                            </button>
                            <button class="btn btn-difficulty" data-difficulty="HARD">
                                <span class="difficulty-icon">üò†</span>
                                <span class="difficulty-name">Hard</span>
                                <span class="difficulty-desc">B, A, S cards</span>
                            </button>
                            <button class="btn btn-difficulty" data-difficulty="EXPERT">
                                <span class="difficulty-icon">üòà</span>
                                <span class="difficulty-name">Expert</span>
                                <span class="difficulty-desc">A, S, SS cards</span>
                            </button>
                            <button class="btn btn-difficulty" data-difficulty="LEGENDARY">
                                <span class="difficulty-icon">üíÄ</span>
                                <span class="difficulty-name">Legendary</span>
                                <span class="difficulty-desc">S, SS, SSS cards</span>
                            </button>
                        </div>
                        <button id="cancel-bot-btn" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>

                <div class="section">
                    <h3>Join a Game</h3>
                    <input type="text" id="join-code-input" placeholder="Enter lobby code" maxlength="20">
                    <button id="join-game-btn" class="btn btn-primary">Join Lobby</button>
                    <p class="connection-status hidden" id="join-status">Connecting...</p>
                </div>

                <div class="section">
                    <h3>üè¥‚Äç‚ò†Ô∏è Team Battle Mode (NEW)</h3>
                    <button id="play-team-battle-btn" class="btn btn-primary">Play Team Battle</button>
                </div>

                <div class="section">
                    <h3>Host a Game</h3>
                    <button id="host-game-btn" class="btn btn-primary">Create Lobby</button>
                    <div id="lobby-code-display" class="hidden">
                        <p>Lobby Code: <strong id="lobby-code"></strong></p>
                        <button id="copy-link-btn" class="btn btn-secondary btn-small" style="margin-top: 10px;">üìã Copy Join Link</button>
                        <p class="connection-status" id="connection-status">Initializing connection...</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Your Collection</h3>
                <button id="view-collection-btn" class="btn btn-secondary">View Cards</button>
                <button id="view-admin-btn" class="btn btn-secondary">‚öôÔ∏è Admin Panel</button>
                <button id="show-music-btn" class="btn btn-secondary hidden">üéµ Show Music Player</button>
            </div>
        </div>
    </div>

    <!-- Collection Screen -->
    <div id="collection-screen" class="screen">
        <div class="container">
            <div class="header">
                <h2>Card Collection</h2>
                <button id="back-to-lobby-btn" class="btn btn-small">Back to Lobby</button>
            </div>
            <div class="filter-section">
                <select id="saga-filter">
                    <option value="all">All Sagas</option>
                </select>
                <select id="arc-filter">
                    <option value="all">All Arcs</option>
                </select>
                <label class="filter-checkbox">
                    <input type="checkbox" id="owned-only-filter">
                    <span>Show Only Owned Cards</span>
                </label>
                <select id="rarity-filter" class="filter-select">
                    <option value="all">All Rarities</option>
                    <option value="SSS">SSS - Legendary</option>
                    <option value="SS">SS - Mythic</option>
                    <option value="S">S - Epic</option>
                    <option value="A">A - Rare</option>
                    <option value="B">B - Uncommon</option>
                    <option value="C">C - Common</option>
                    <option value="D">D - Basic</option>
                    <option value="F">F - Starter</option>
                </select>
            </div>
            <div id="collection-grid" class="card-grid"></div>
        </div>
    </div>
    
    <!-- Admin Panel Screen -->
    <div id="admin-screen" class="screen">
        <div class="admin-panel">
            <!-- Back button in its own row at top -->
            <div class="admin-header">
                <button id="back-to-lobby-admin-btn" class="btn btn-secondary">‚Üê Back to Lobby</button>
            </div>

            <!-- Arc Availability - Full width -->
            <section class="admin-section admin-section-full">
                <h3>Arc Availability</h3>
                <p class="help-text">Toggle which arcs are available in the card pool</p>
                <div id="arc-toggles" class="arc-toggles">
                    <!-- Arc toggles will be generated here -->
                </div>
            </section>

            <!-- Rarity Distribution - Full width -->
            <section class="admin-section admin-section-full">
                <h3>Rarity Distribution</h3>
                <div id="rarity-stats" class="rarity-stats">
                    <!-- Rarity statistics will be shown here -->
                </div>
            </section>

            <!-- Two columns for Card Pool Status and Test Deck -->
            <div class="admin-bottom-grid">
                <section class="admin-section">
                    <h3>Card Pool Status</h3>
                    <div id="pool-stats" class="pool-stats">
                        <p>Total Cards in Database: <strong id="total-cards">0</strong></p>
                        <p>Available Cards: <strong id="available-cards">0</strong></p>
                        <p>Active Arcs: <strong id="active-arcs">0</strong></p>
                    </div>
                </section>

                <section class="admin-section">
                    <h3>Test Starter Deck</h3>
                    <button id="test-deck-btn" class="btn btn-primary">Generate Test Deck</button>
                    <div id="test-deck-display" class="test-deck-display"></div>
                </section>
            </div>
        </div>
    </div>
        <!-- Team Battle Select Screen -->
    <div id="team-battle-select-screen" class="screen">
        <div class="container">
            <div class="header">
                <h2>‚öîÔ∏è Team Battle Mode ‚öîÔ∏è</h2>
                <button id="back-from-team-select-btn" class="btn btn-small">Back to Lobby</button>
            </div>
            
            <div class="team-mode-selection">
                <div class="mode-card" id="davy-back-mode">
                    <h3>üè¥‚Äç‚ò†Ô∏è Davy Back Fight</h3>
                    <p class="mode-description">Balanced team composition</p>
                    <div class="role-list">
                        <span class="role-badge captain">Captain (√ó2.0)</span>
                        <span class="role-badge vice">Vice-Captain (√ó1.5)</span>
                        <span class="role-badge tank">Tank (√ó1.3)</span>
                        <span class="role-badge healer">Healer (√ó1.2)</span>
                        <span class="role-badge support">Support (√ó1.1)</span>
                        <span class="role-badge support">Support (√ó1.1)</span>
                    </div>
                    <button class="btn btn-primary select-mode-btn" data-mode="DAVY_BACK">Select Mode</button>
                </div>
                
                <div class="mode-card" id="classic-pirate-mode">
                    <h3>üíÄ Classic Pirate</h3>
                    <p class="mode-description">High risk, high reward</p>
                    <div class="role-list">
                        <span class="role-badge captain">Captain (√ó2.0)</span>
                        <span class="role-badge vice">Vice-Captain (√ó1.5)</span>
                        <span class="role-badge tank">Tank (√ó1.3)</span>
                        <span class="role-badge healer">Healer (√ó1.2)</span>
                        <span class="role-badge support">Support (√ó1.1)</span>
                        <span class="role-badge traitor">Traitor (√ó-0.5)</span>
                    </div>
                    <button class="btn btn-primary select-mode-btn" data-mode="CLASSIC_PIRATE">Select Mode</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Battle Wager Screen -->
    <div id="team-battle-wager-screen" class="screen">
        <div class="container">
            <div class="header">
                <h2>Set Your Wager</h2>
                <button id="back-from-wager-btn" class="btn btn-small">Back</button>
            </div>
            
            <p class="wager-description">How many cards should the winner take from the loser?</p>
            
            <div class="wager-selector">
                <button class="btn wager-btn" data-wager="1">1 Card</button>
                <button class="btn wager-btn" data-wager="2">2 Cards</button>
                <button class="btn wager-btn" data-wager="3">3 Cards</button>
                <button class="btn wager-btn" data-wager="5">5 Cards</button>
            </div>
            
            <div class="difficulty-selector" id="team-battle-difficulty">
                <h4>Select Bot Difficulty:</h4>
                <div class="difficulty-buttons">
                    <button class="btn btn-difficulty" data-difficulty="EASY">
                        <span class="difficulty-icon">üòä</span>
                        <span class="difficulty-name">Easy</span>
                    </button>
                    <button class="btn btn-difficulty" data-difficulty="NORMAL">
                        <span class="difficulty-icon">üôÇ</span>
                        <span class="difficulty-name">Normal</span>
                    </button>
                    <button class="btn btn-difficulty" data-difficulty="HARD">
                        <span class="difficulty-icon">üò†</span>
                        <span class="difficulty-name">Hard</span>
                    </button>
                    <button class="btn btn-difficulty" data-difficulty="EXPERT">
                        <span class="difficulty-icon">üòà</span>
                        <span class="difficulty-name">Expert</span>
                    </button>
                    <button class="btn btn-difficulty" data-difficulty="LEGENDARY">
                        <span class="difficulty-icon">üíÄ</span>
                        <span class="difficulty-name">Legendary</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Battle Assignment Screen -->
    <div id="team-battle-game-screen" class="screen">
        <div class="container">
            <div class="team-battle-header">
                <div class="team-info">
                    <h3 id="tb-player1-name">Player 1</h3>
                    <p class="team-score">Wager: <span id="tb-player1-wager">1</span> card(s)</p>
                </div>
                <div class="assignment-phase">
                    <p>Assignment Phase: <span id="tb-phase">1</span>/6</p>
                    <p id="tb-turn-indicator">Your Turn</p>
                </div>
                <div class="team-info">
                    <h3 id="tb-player2-name">Player 2</h3>
                    <p class="team-score">Wager: <span id="tb-player2-wager">1</span> card(s)</p>
                </div>
            </div>

            <!-- Card Draw Area (above teams) -->
            <div id="tb-card-selection" class="tb-card-selection-top">
                <!-- Card draw area will be rendered here -->
            </div>

            <!-- Role Assignment Controls -->
            <div id="tb-assignment-controls" class="assignment-controls hidden">
                <h3>Assign <span id="tb-selected-card-name"></span> to Role:</h3>
                <div id="tb-role-buttons" class="role-buttons"></div>
            </div>

            <!-- Teams Display -->
            <div class="team-battle-board">
                <div class="team-column" id="tb-player1-column">
                    <h4>Your Team</h4>
                    <div class="role-slots" id="tb-player1-slots"></div>
                </div>
                
                <div class="vs-divider">VS</div>
                
                <div class="team-column" id="tb-player2-column">
                    <h4>Opponent Team</h4>
                    <div class="role-slots" id="tb-player2-slots"></div>
                </div>
            </div>

            <button id="tb-concede-btn" class="btn btn-danger">Concede</button>
        </div>
    </div>

    <!-- Team Battle Results Screen -->
    <div id="team-battle-results-screen" class="screen">
        <div class="container">
            <h1 id="tb-result-title"></h1>
            <div id="tb-result-stats"></div>
            
            <div class="team-comparison">
                <div class="final-team">
                    <h3 id="tb-final-p1-name">Your Team</h3>
                    <div id="tb-final-p1-roles" class="final-roles"></div>
                    <p class="final-score">Total: <span id="tb-final-p1-score"></span></p>
                </div>
                
                <div class="final-team">
                    <h3 id="tb-final-p2-name">Opponent Team</h3>
                    <div id="tb-final-p2-roles" class="final-roles"></div>
                    <p class="final-score">Total: <span id="tb-final-p2-score"></span></p>
                </div>
            </div>
            
            <div id="tb-cards-won-display" class="hidden">
                <h3>Cards Won:</h3>
                <div id="tb-cards-won-grid" class="card-grid"></div>
            </div>
            
            <button id="tb-return-lobby-btn" class="btn btn-primary">Return to Lobby</button>
            <a href="https://square.link/u/T6XoDQMr" target="_blank" class="support-link">
                <button class="btn btn-support">‚òï Enjoyed the game? Support me!</button>
            </a>
        </div>
    </div>
    
    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <div class="container">
            <div class="game-header">
                <div class="player-info" id="player1-info">
                    <h3 id="player1-name">Player 1</h3>
                    <p>Cards: <span id="player1-cards">5</span></p>
                    <div class="score-display">Score: <span id="player1-score">0</span></div>
                </div>
                <div class="round-info">
                    <p>Round <span id="round-number">1</span>/5</p>
                </div>
                <div class="player-info" id="player2-info">
                    <h3 id="player2-name">Player 2</h3>
                    <p>Cards: <span id="player2-cards">5</span></p>
                    <div class="score-display">Score: <span id="player2-score">0</span></div>
                </div>
            </div>

            <div class="game-board">
                <div class="card-slot" id="player1-card-slot">
                    <div class="card-back"><img src="https://toppng.com/uploads/thumbnail/jolly-roger-anime-one-manga-anime-straw-hats-straw-hat-pirates-jolly-roger-11562951369qechcoicmy.png" alt="Card Back"></div>
                </div>
                <div class="vs">VS</div>
                <div class="card-slot" id="player2-card-slot">
                    <div class="card-back"><img src="https://toppng.com/uploads/thumbnail/jolly-roger-anime-one-manga-anime-straw-hats-straw-hat-pirates-jolly-roger-11562951369qechcoicmy.png" alt="Card Back"></div>
                </div>
            </div>

            <div class="game-controls">
                <button id="play-card-btn" class="btn btn-primary btn-large">Play Card</button>
                <button id="concede-btn" class="btn btn-danger">Concede</button>
            </div>

            <div id="waiting-message" class="waiting-message hidden">
                Waiting for opponent...
            </div>

            <div id="result-display" class="result-display hidden">
                <h2 id="result-text"></h2>
                <button id="continue-btn" class="btn btn-primary">Continue</button>
            </div>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameover-screen" class="screen">
        <div class="container">
            <h1 id="gameover-result"></h1>
            <div id="gameover-stats"></div>
            <div id="cards-won-display" class="hidden">
                <h3>Cards Won:</h3>
                <div id="cards-won-grid" class="card-grid"></div>
            </div>
            <button id="return-lobby-btn" class="btn btn-primary">Return to Lobby</button>
            <a href="https://square.link/u/T6XoDQMr" target="_blank" class="support-link">
                <button class="btn btn-support">‚òï Enjoyed the game? Support me!</button>
            </a>
        </div>
    </div>

    <script src="js/dev-config.js"></script>
    <script src="js/config.js"></script>
    <script src="js/music.js"></script>
    <script src="js/p2p.js"></script>
    <script src="js/game.js"></script>
    <script src="js/team-battle.js"></script>
    <script src="js/main.js"></script>
    <!-- Scroll to Top Button -->
    <div id="scroll-top-btn" class="scroll-top"></div>
    
    <!-- Footer -->
    <footer id="site-footer" class="site-footer">
        <p id="version-info">v1.2</p>
        <p class="credits">¬© 2026 One Piece Card War | One Piece ¬© Eiichiro Oda</p>
    </footer>
</body>
</html>
